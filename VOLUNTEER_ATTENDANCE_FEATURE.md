# Функционал отметки присутствия для волонтеров

## Описание

Добавлен полноценный функционал для волонтеров по отметке присутствия участников на чемпионате. Волонтеры могут видеть рассадку участников по кабинетам и отмечать, кто пришел на мероприятие.

## Что было добавлено

### Backend

#### 1. Модель User
- Добавлено поле `attendance` (boolean, по умолчанию `false`)

#### 2. Attendance Service (`backend/service/attendance-service.js`)
Новый сервис для работы с присутствием:
- `getParticipantsWithSeating()` - получить всех участников с рассадкой по кабинетам
- `markAttendance(userId, attendance)` - отметить присутствие одного участника
- `markMultipleAttendance(userIds, attendance)` - массовая отметка присутствия
- `getAttendanceStatistics()` - получить статистику по присутствию

#### 3. Attendance Controller (`backend/controllers/attendance-controller.js`)
Контроллер для обработки запросов волонтеров

#### 4. API Routes (`backend/router/index.js`)
Новые эндпоинты для волонтеров:
- `GET /api/volunteer/participants` - список участников с рассадкой
- `POST /api/volunteer/attendance/mark` - отметить присутствие
- `POST /api/volunteer/attendance/mark-multiple` - массовая отметка
- `GET /api/volunteer/attendance/statistics` - статистика

Все эндпоинты защищены `volunteerMiddleware`

### Frontend

#### 1. Attendance Service (`frontend/app/src/services/AttendanceService.js`)
Сервис для работы с API отметки присутствия

#### 2. Страницы волонтера

**VolunteerDashboard** (`frontend/app/src/pages/volunteer/VolunteerDashboard.js`)
- Главная страница с общей статистикой:
  - Всего участников
  - Присутствуют (с процентом явки)
  - Отсутствуют
- Быстрые действия для перехода к отметке присутствия

**AttendanceList** (`frontend/app/src/pages/volunteer/AttendanceList.js`)
- Полный список участников с рассадкой по кабинетам
- Статистика по присутствию в реальном времени
- Фильтры:
  - По кабинетам (выбор конкретного кабинета или все)
  - Поиск по ФИО, школе, названию команды
- Функции:
  - Отметка присутствия каждого участника индивидуально
  - Массовая отметка всех участников кабинета как присутствующих
  - Массовое снятие отметок с кабинета
- Отображение информации:
  - ФИО участника
  - Школа
  - Название команды (если есть)
  - Статус присутствия (кнопка с цветовой индикацией)

#### 3. Навигация
- Обновлен `VolunteerSidebar` - добавлен пункт меню "Отметка присутствия"
- Обновлен `App.js` - добавлен маршрут `/volunteer/attendance`

## Как это работает

### Для волонтера

1. **Вход в систему**
   - Волонтер входит под своей учетной записью с ролью `volunteer`
   - Автоматически перенаправляется на `/volunteer`

2. **Просмотр статистики**
   - На главной странице видна общая статистика по присутствию
   - Можно быстро оценить явку участников

3. **Отметка присутствия**
   - Переход в раздел "Отметка присутствия"
   - Выбор кабинета из списка или просмотр всех
   - Поиск конкретного участника
   - Клик по кнопке присутствия для отметки/снятия отметки
   - Массовая отметка всего кабинета

### Для администратора

1. **Создание волонтера**
   ```sql
   UPDATE "Users" 
   SET role = 'volunteer' 
   WHERE email = 'volunteer@example.com';
   ```

2. **Рассадка участников**
   - Администратор должен сначала создать рассадку через админ-панель
   - Волонтеры видят только рассаженных участников

## Технические детали

### Структура данных

**Участник с рассадкой:**
```javascript
{
  id: number,
  firstName: string,
  lastName: string,
  secondName: string,
  fullName: string,
  school: string,
  teamName: string | null,
  isTeamMember: boolean,
  attendance: boolean
}
```

**Кабинет с участниками:**
```javascript
{
  room: {
    id: number,
    number: string,
    capacity: number
  },
  participants: Participant[],
  totalParticipants: number,
  presentCount: number
}
```

**Статистика:**
```javascript
{
  totalParticipants: number,
  presentParticipants: number,
  absentParticipants: number,
  attendanceRate: string // процент
}
```

### Безопасность

- Все эндпоинты волонтера защищены `authMiddleware` и `volunteerMiddleware`
- Волонтеры не имеют доступа к:
  - Админ-панели
  - Профилям участников
  - Редактированию данных (кроме отметки присутствия)

### Производительность

- Данные загружаются один раз при открытии страницы
- После каждой отметки данные перезагружаются для актуальности
- Фильтрация работает на клиенте (без дополнительных запросов)

## Примеры использования

### Отметить одного участника
```javascript
await AttendanceService.markAttendance(userId, true);
```

### Отметить весь кабинет
```javascript
const userIds = participants.map(p => p.id);
await AttendanceService.markMultipleAttendance(userIds, true);
```

### Получить статистику
```javascript
const stats = await AttendanceService.getStatistics();
// { totalParticipants: 100, presentParticipants: 85, ... }
```

## UI/UX особенности

- **Цветовая индикация:**
  - Зеленый (✓ Присутствует) - участник отмечен
  - Красный (✗ Отсутствует) - участник не отмечен

- **Статистика в реальном времени:**
  - Обновляется после каждой отметки
  - Показывается для каждого кабинета отдельно
  - Общая статистика на главной странице

- **Удобная фильтрация:**
  - Быстрый выбор кабинета
  - Поиск по любым полям
  - Счетчики участников в каждом кабинете

## Будущие улучшения

Возможные доработки:
- QR-код сканирование для быстрой отметки
- Экспорт списка присутствующих в Excel
- История изменений (кто и когда отметил)
- Push-уведомления при изменении статистики
- Мобильная версия для планшетов

## Тестирование

### Создание тестового волонтера

```sql
-- Создать нового волонтера
INSERT INTO "Users" (
    email, password, role, "isActivated", 
    last_name, first_name, birthday, region, city, 
    school, programming_language, phone, grade, 
    participation_format
) VALUES (
    'volunteer@it-vysotka.ru',
    '$2b$10$hashed_password_here',
    'volunteer',
    true,
    'Волонтеров',
    'Иван',
    '2000-01-01',
    'Республика Башкортостан',
    'Уфа',
    'УГНТУ',
    'Не указано',
    '+79999999999',
    11,
    'individual'
);
```

### Проверка функционала

1. Войти под волонтером
2. Проверить отображение статистики
3. Открыть "Отметка присутствия"
4. Проверить фильтры
5. Отметить несколько участников
6. Проверить обновление статистики
7. Массово отметить кабинет
8. Проверить поиск

## Заключение

Функционал полностью готов к использованию. Волонтеры могут эффективно отмечать присутствие участников, видеть статистику в реальном времени и работать с удобными фильтрами.

